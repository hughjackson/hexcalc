<!DOCTYPE html>
<html>
<title>HexCalc</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#3f51b5">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<style>
.w3-col {padding:0px}
.w3-button, #keypad {width:100%}
.w3-fifth {width:19.9999%}
.w3-eighth {width:12.4999%}
.numkey, .numkey:hover{background-color:#607d8b!important; color: white!important}
.opkey, .opkey:hover, .spkey, .spkey:hover, .pukey, .pukey:hover {background-color:#616161!important; color: white!important}
body {display:flex; flex-flow:column; height:100vh}
#display {flex: 0 1 auto}
#keypad, #binpad {flex: 1 0 auto; font-size: 24px!important; flex-flow:column}
#keypad {display:flex}
#binpad {display:none}
.output {padding:8px}
.w3-row {flex: 1 1 auto; display:flex; flex-flow:row}
.w3-col {display:flex; flex-flow:column}
.w3-button {flex: 1 1 auto}
body {counter-reset: section 32}
#binpad .numkey::before {
    counter-increment: section -1;
    content: counter(section);
    display: block;
    font-size: 12px!important;
}
</style>
<body>

<div id="display">
  <div id="hex" class="output mode-sel w3-large w3-bar w3-indigo">0</div>
  <div id="dec" class="output mode-sel w3-large w3-bar w3-blue">0</div>
  <div id="bin" class="output mode-sel w3-large w3-bar w3-teal">0</div>
</div>

<div id="binpad">
  <div class="w3-row">
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
  </div>
  <div class="w3-row">
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
  </div>
  <div class="w3-row">
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
  </div>
  <div class="w3-row">
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col w3-eighth">
      <button class="w3-button numkey">1</button>
    </div>
  </div>
</div>

<div id="keypad">
  <div class="w3-row">
    <div class="w3-col s3">
      <button class="w3-button pukey">(</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button pukey">)</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button pukey">&Sqrt;</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button opkey">**</button>
    </div>
  </div>

  <div class="w3-row">
    <div class="w3-col s3">
      <button class="w3-button numkey hexkey">D</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey hexkey">E</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey hexkey">F</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button spkey">Del</button>
    </div>
  </div>

  <div class="w3-row">
    <div class="w3-col s3">
      <button class="w3-button numkey hexkey">A</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey hexkey">B</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey hexkey">C</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button opkey">/</button>
    </div>
  </div>

  <div class="w3-row">
    <div class="w3-col s3">
      <button class="w3-button numkey">7</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey">8</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey">9</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button opkey">*</button>
    </div>
  </div>

  <div class="w3-row">
    <div class="w3-col s3">
      <button class="w3-button numkey">4</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey">5</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey">6</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button opkey">-</button>
    </div>
  </div>

  <div class="w3-row">
    <div class="w3-col s3">
      <button class="w3-button numkey">1</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey">2</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey">3</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button opkey">+</button>
    </div>
  </div>

  <div class="w3-row">
    <div class="w3-col s3">
      <button class="w3-button spkey">Ans</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey">0</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button numkey deckey">.</button>
    </div>
    <div class="w3-col s3">
      <button class="w3-button spkey">=</button>
    </div>
  </div>
</div>

<script>
ans=0
clear=true
mode='dec'

// Number to string
function numString(num, radix) {
  console.log("convert " + num + " to " + radix)
  if (radix == 10) {
    if (num > (2**31-1)) num = num-2**32
    return num.toString(radix)
  }
  str = (num >>> 0).toString(radix).toUpperCase()
  // zero pad
  if (radix == 2)
    str = "000" + str
  else
    str = "   " + str
  str = str.slice(str.length % 4)
  // add underscores
  str = str.replace(/(....)\B/g, "$1_")
  str = str.replace(/ /g, "")
  return str
}

// Update the mode
function updateMode(op) {
  console.log("Update mode")
  mode = op.id
  clear = true

  // Find all the output
  outputs = document.getElementsByClassName('output')
  for (i=0; i< outputs.length; i++) {
    outputs[i].style.setProperty("font-size", "18px", "important")
  }
  document.getElementById(mode).style.setProperty("font-size", "36px", "important")

  buttons = document.getElementsByClassName('numkey')
  for (i=0; i< buttons.length; i++) {
    buttons[i].disabled = false
  }
  if (mode != "hex") {
    buttons = document.getElementsByClassName("hexkey")
    for (i=0; i< buttons.length; i++) {
      buttons[i].disabled = true
    }
  } 
  if (mode != "dec") {
    buttons = document.getElementsByClassName("deckey")
    for (i=0; i< buttons.length; i++) {
      buttons[i].disabled = true
    }
  }

  if (mode == "bin") {
    document.getElementById("keypad").style.display = "none"
    document.getElementById("binpad").style.display = "flex"

    // update button values
    ext = ("0".repeat(32) + document.getElementById('bin').innerText.replace(/_/g,"")).slice(-32)
    btns = document.getElementById("binpad").getElementsByClassName("numkey")
    for (i = 0; i < btns.length; i++) {
      btns[i].innerText = ext[i]
    }
  } else {
    document.getElementById("keypad").style.display = "flex"
    document.getElementById("binpad").style.display = "none"
  }
}

// Button click function
function keyClick(key) {
  hexout = document.getElementById('hex')
  decout = document.getElementById('dec')
  binout = document.getElementById('bin')

  if (mode == "bin") {
    key.innerText ^= 1
    btns = document.getElementById("binpad").getElementsByClassName("numkey")
    for (i = 0; i < btns.length; i++) {
      if (key == btns[i]) {
        ans ^= 2 ** (31 - i)
        hexout.innerText = numString(ans, 16)
        decout.innerText = numString(ans, 10)
        binout.innerText = numString(ans, 2)
      }
    }
    return
  } else if (mode == "hex") {
    output = hexout
    length = 16
    repl   = "0x$1"
  } else {
    output = decout
    length = 10
    repl   = "$1"
  }

  // clear before entry
  if (clear && key.innerText != "=" && key.innerText != "Del")
    if (key.className.indexOf('opkey') != -1)
      output.innerText = numString(ans, length)
    else
      output.innerText = ""
    clear = false

  if (key.className.indexOf('spkey') == -1) {
    output.innerText += key.innerText
  }

  switch (key.innerText) {
    case '=' : 
      cmd = output.innerText.replace(/\b([A-F0-9]+)/g,repl)
                            .replace(/([^0-9A-Fx]|^)√([0-9A-Fx]*)/g, "$1($2**(1/2))")
                            .replace(/([0-9A-Fx]*)√([0-9A-Fx]*)/g, "($2**(1/$1))")
      console.log(cmd)
      ans = eval(cmd)
      hexout.innerText = numString(ans, 16)
      decout.innerText = numString(ans, 10)
      binout.innerText = numString(ans, 2)
      clear = true
      break;
    case 'Ans' :
      output.innerText += numString(ans, length)
      break;
    case 'Del':
      if (output.innerText.length > 1) {
        output.innerText = output.innerText.slice(0,-1)
      } else {
        output.innerText = "0"
        clear = true;
      }
      break;
    default:
  }
}

// Find all the button
buttons = document.getElementsByClassName('w3-button')
// Set aspect ration to 2/3
for (i=0; i< buttons.length; i++) {
  //buttons[i].style.height = buttons[i].clientWidth*2/3 + "px"
  buttons[i].onclick = function() { keyClick(this); };
}
// Find all the output
outputs = document.getElementsByClassName('mode-sel')
// Set aspect ration to 2/3
for (i=0; i< outputs.length; i++) {
  outputs[i].onclick = function() { updateMode(this); };
  console.log("set output")
}
// Set initial mode
updateMode(document.getElementById('dec'))

// Scroll to bottom (hide address bar on mobile)
scroll(0,document.body.scrollHeight)
</script>

</body>
</html>

